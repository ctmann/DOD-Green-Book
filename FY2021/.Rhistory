glimpse(outlays1)
glimpse(outlays.1)
outlays.1 <- read_excel(paste0(chapter.6.raw.data.folder,
tbl.6.22.Army),
na = "0")
glimpse(outlays.1)
outlays.1 <- read_excel(paste0(chapter.6.raw.data.folder,
tbl.6.22.Army),
na = "0", col_names=F)
glimpse(outlays.1)
x <- 0:5
rep_along(x, 1:2)
rep(x="",6)
rep("delete",6)
current.constant.col <- c(rep("delete",  6), #first 7 rows
rep("current", 7), #7:14
rep("delete",  2), #15:16
rep("constant",8) #17:24
)
current.constant.col
outlays1$current.constant.col
outlays.1$deflator.type <- current.constant.col
current.constant.col <- c(rep("delete",   6), #first 7 rows
rep("current",  7), #7:14
rep("delete",   2), #15:16
rep("constant", 8),  #17:24
rep("delete",  11), #24:35
)
current.constant.col
current.constant.col <- c(rep("delete",   6), #first 7 rows
rep("current",  7), #7:14
rep("delete",   2), #15:16
rep("constant", 8),  #17:24
rep("delete",  11), #24:35
)
current.constant.col <- c(rep("delete",   6), #first 7 rows
rep("current",  7), #7:14
rep("delete",   2), #15:16
rep("constant", 8),  #17:24
rep("delete",  11) #24:35
)
current.constant.col <- c(rep("delete",   6), #first 7 rows
rep("current",  7), #7:14
rep("delete",   2), #15:16
rep("constant", 8),  #17:24
rep("delete",  11) #24:35
)
current.constant.col
outlays.1$deflator.type <- current.constant.col
outlays.1
View(outlays)
View(outlays.1)
names(outlays)
names(outlays.1)
outlays %>% ncol()
outlays.1 %>% ncol()
outlays.1[,c(ncol(), 1:ncol()-1 )]
outlays.1[,c(ncol(outlays.1), 1:ncol(outlays.1)-1 )]
outlays.1[,c(ncol(outlays.1), 1:ncol(outlays.1)-1 )] %>% View()
current.constant.col <- c(rep("delete",   6), #first 7 rows
rep("current",  8), #7:14
rep("delete",   2), #15:16
rep("constant", 8),  #17:24
rep("delete",  11) #24:35
)
outlays.1$deflator.type <- current.constant.col
outlays.1[,c(ncol(outlays.1), 1:ncol(outlays.1)-1 )] %>% View()
current.constant.col <- c(rep("delete",   6), #first 7 rows
rep("current",  9), #7:14
rep("delete",   2), #15:16
rep("constant", 8),  #17:24
rep("delete",  11) #24:35
)
outlays.1$deflator.type <- current.constant.col
outlays.1[,c(ncol(outlays.1), 1:ncol(outlays.1)-1 )] %>% View()
current.constant.col
current.constant.col <- c(rep("delete",   6), #first 7 rows
rep("current",  8), #7:14
rep("delete",   2), #15:16
rep("constant", 8),  #17:24
rep("delete",  11) #24:35
)
current.constant.col
outlays.1 <- read_excel(paste0(chapter.6.raw.data.folder,
tbl.6.22.Army),
na = "0", col_names=F, n_max=35)
outlays.1$deflator.type <- current.constant.col
current.constant.col <- c(rep("delete",   6), #first 7 rows
rep("current",  8), #7:14
rep("delete",   2), #15:16
rep("constant", 8),  #17:24
rep("delete",  10) #24:35
)
outlays.1$deflator.type <- current.constant.col
outlays.1 <- read_excel(paste0(chapter.6.raw.data.folder,
tbl.6.22.Army),
na = "0", col_names=F, n_max=34)
glimpse(outlays.1)
current.constant.col <- c(rep("delete",   6), #first 7 rows
rep("current",  8), #7:14
rep("delete",   2), #15:16
rep("constant", 8),  #17:24
rep("delete",  10) #24:35
)
outlays.1$deflator.type <- current.constant.col
outlays.1[,c(ncol(outlays.1), 1:ncol(outlays.1)-1 )] %>% View()
View(outlays.1)
outlays.1 <- outlays.1[,c(ncol(outlays.1),
1:ncol(outlays.1)-1 )]
file.name <- (paste0(chapter.6.raw.data.folder,
tbl.6.22.Army)
file.name <- paste0(chapter.6.raw.data.folder,
tbl.6.22.Army)
chapter.6.raw.data.folder
tbl.6.22.Army
paste0(chapter.6.raw.data.folder,
tbl.6.22.Army)
file.name <- paste0(chapter.6.raw.data.folder,
tbl.6.22.Army)
file.name <- paste0(chapter.6.raw.data.folder,
tbl.6.22.Army)
my.table.number <- "6.22"
dod.service <- "army"
dod.service
my.table.number
file.name <- paste0(chapter.6.raw.data.folder,
tbl.6.22.Army)
my.table.number <- "6.22"
dod.service <- "army"
nettle_clean <- function(file.name,
my.table.number,
dod.service){
outlays.1 <- read_excel(file.name, na = "0", col_names=F, n_max=35)
}
file.name <- paste0(chapter.6.raw.data.folder, tbl.6.22.Army)
my.table.number <- "6.22"
dod.service <- "army"
file.name <- paste0(chapter.6.raw.data.folder, tbl.6.22.Army)
my.table.number <- "6.22"
dod.service <- "army"
nettle_clean(file.name=file.name,
my.table.number=my.table.number,
dod.service=dod.service)
nettle_clean(file.name=file.name,
my.table.number=my.table.number,
dod.service=dod.service) %>% View()
nettle_clean <- function(file.name,
my.table.number,
dod.service){
outlays.1 <- read_excel(file.name, na = "0", col_names=F, n_max=35)
#Manually enter deflator col
current.constant.col <- c(rep("delete",   6), #first 7 rows
rep("current",  8), #7:14
rep("delete",   2), #15:16
rep("constant", 8),  #17:24
rep("delete",  10) #24:35
)
outlays.1$deflator.type <- current.constant.col
outlays.1 <- outlays.1[,c(ncol(outlays.1),
1:ncol(outlays.1)-1 )]
}
nettle_clean <- function(file.name,
my.table.number,
dod.service){
outlays.1 <- read_excel(file.name, na = "0", col_names=F, n_max=35)
#Manually enter deflator col
current.constant.col <- c(rep("delete",   6), #first 7 rows
rep("current",  8), #7:14
rep("delete",   2), #15:16
rep("constant", 8),  #17:24
rep("delete",  10) #24:35
)
outlays.1$deflator.type <- current.constant.col
outlays.1 <- outlays.1[,c(ncol(outlays.1),
1:ncol(outlays.1)-1 )]
}
file.name <- paste0(chapter.6.raw.data.folder, tbl.6.22.Army)
my.table.number <- "6.22"
dod.service <- "army"
army.df <- nettle_clean(file.name=file.name,
my.table.number=my.table.number,
dod.service=dod.service)
View(army.df)
tibble( current.constant.col = c(rep("delete",   6), #first 7 rows
rep("current",  8), #7:14
rep("delete",   2), #15:16
rep("constant", 8),  #17:24
rep("delete",  10) #24:35
)
)
tibble( current.constant.col = c(rep("delete",  6), #first 6 rows
rep("current",  8),  #7:14
rep("delete",   2),  #15:16
rep("constant", 8),  #17:25
rep("delete",  10)   #24:35
)
dod.service = dod.service
)
dod.service
tibble( current.constant.col = c(rep("delete",  6), #first 6 rows
rep("current",  8),  #7:14
rep("delete",   2),  #15:16
rep("constant", 8),  #17:25
rep("delete",  10)   #24:34
)
dod.service = rep(dod.service, 34)
)
rep(dod.service, 34)
tibble( current.constant.col = c(rep("delete",  6), #first 6 rows
rep("current",  8),  #7:14
rep("delete",   2),  #15:16
rep("constant", 8),  #17:25
rep("delete",  10)   #24:34
)
dod.service = rep(dod.service, 34)
tibble( current.constant.col = c(rep("delete",  6), #first 6 rows
rep("current",  8),  #7:14
rep("delete",   2),  #15:16
rep("constant", 8),  #17:25
rep("delete",  10)   #24:34
),
dod.service = rep(dod.service, 34)
tibble( current.constant.col = c(rep("delete",  6), #first 6 rows
rep("current",  8),  #7:14
rep("delete",   2),  #15:16
rep("constant", 8),  #17:25
rep("delete",  10)   #24:34
),
dod.service = rep(dod.service, 34)
)
tibble( current.constant.col = c(rep("delete",  6), #first 6 rows
rep("current",  8),  #7:14
rep("delete",   2),  #15:16
rep("constant", 8),  #17:25
rep("delete",  10)   #24:34
),
dod.service = rep(dod.service, 34)
)
tibble( current.constant.col = c(rep("delete",  6), #first 6 rows
rep("current",  8),  #7:14
rep("delete",   2),  #15:16
rep("constant", 8),  #17:25
rep("delete",  10)   #24:34
),
dod.service = dod.service)
)
tibble( current.constant.col = c(rep("delete",  6), #first 6 rows
rep("current",  8),  #7:14
rep("delete",   2),  #15:16
rep("constant", 8),  #17:25
rep("delete",  10)   #24:34
),
Service = dod.service,
source.table = my.table.number)
)
meta.cols <- tibble( current.constant.col = c(rep("delete",  6), #first 6 rows
rep("current",  8),  #7:14
rep("delete",   2),  #15:16
rep("constant", 8),  #17:25
rep("delete",  10)   #24:34
),
Service = dod.service,
source.table = my.table.number)
bind_cols(meta.cols, outlays.1)
outlays.2 <- bind_cols(meta.cols, outlays.1)
nettle_clean <- function(file.name,
my.table.number,
dod.service){
outlays.1 <- read_excel(file.name, na = "0", col_names=F, n_max=35)
#Manually enter deflator col
meta.cols <- tibble( current.constant.col = c(rep("delete",  6), #first 6 rows
rep("current",  8),  #7:14
rep("delete",   2),  #15:16
rep("constant", 8),  #17:25
rep("delete",  10)   #24:34
),
Service = dod.service,
source.table = my.table.number)
outlays.2 <- bind_cols(meta.cols, outlays.1)
}
file.name <- paste0(chapter.6.raw.data.folder, tbl.6.22.Army)
my.table.number <- "6.22"
dod.service <- "army"
army.df <- nettle_clean(file.name=file.name,
my.table.number=my.table.number,
dod.service=dod.service)
outlays.2 %>% names()
outlays.2[,5:81] %>% names()
ncol(outlays.2)
ncol(outlays.2-4)
ncol(outlays.2)-4
ncol(outlays.2)-4
add.col.number <- ncol(outlays.2)-4
col.number <- ncol(outlays.2)-4
col.number
names(outlays.2[,1:4]
names(outlays.2[,1:4])
names(outlays.2[,1:4])
c(names(outlays.2[,1:4]),
1946:(ncol(outlays.2)-4)
c(names(outlays.2[,1:4]),
1946:(ncol(outlays.2)-4))
c(names(outlays.2[,1:4]),
1946:(ncol(outlays.2)-4))
names(outlays.2[,1:4]
names(outlays.2[,1:4]
names(outlays.2[,1:4]
names(outlays.2[,1:4]
names(outlays.2[,1:4])
1946:(ncol(outlays.2)-4)
ncol(outlays.2)-4
1946:(ncol(outlays.2)-4)
(ncol(outlays.2)-4)
c(names(outlays.2[,1:4]),
1946:1946+(ncol(outlays.2)-4) )
c(names(outlays.2[,1:4]),
1946:1946+(ncol(outlays.2)-4) )
c(names(outlays.2[,1:4]),
1946:(1946+(ncol(outlays.2)-4)) )
c(names(outlays.2[,1:4]),
1946:(1946+(ncol(outlays.2)-2)) )
c(names(outlays.2[,1:4]),
1946:(1946+(ncol(outlays.2)-2)) )
c(names(outlays.2[,1:4]),
1946:(1946+(ncol(outlays.2)-6)) )
names(outlays.2) <- c(names(outlays.2[,1:4]),
1946:(1946+(ncol(outlays.2)-6)) )
View(outlays(2)
View(outlays.2)
c(names(outlays.2[,1:4]),
"Public.Law.Title",
1946:(1946+(ncol(outlays.2)-6)) )
nettle_clean <- function(file.name,
my.table.number,
dod.service){
outlays.1 <- read_excel(file.name, na = "0", col_names=F, n_max=35)
#Manually enter deflator col
meta.cols <- tibble( current.constant.col = c(rep("delete",  6), #first 6 rows
rep("current",  8),  #7:14
rep("delete",   2),  #15:16
rep("constant", 8),  #17:25
rep("delete",  10)   #24:34
),
Service = dod.service,
source.table = my.table.number)
outlays.2 <- bind_cols(meta.cols, outlays.1)
names(outlays.2) <- c(names(outlays.2[,1:4]),
"Public.Law.Title",
1946:(1946+(ncol(outlays.2)-6)) )
}
file.name <- paste0(chapter.6.raw.data.folder, tbl.6.22.Army)
my.table.number <- "6.22"
dod.service <- "army"
army.df <- nettle_clean(file.name=file.name,
my.table.number=my.table.number,
dod.service=dod.service)
View(army.df)
outlays.2
# Info --------------------------------------------------------------------
#' Table 6.22-6.24 DOD OUTLAYS By by Service and Title
#' # How to Update this File -------------------------------------------------
#'
#'   1) Set working Directory to current year:
setwd("./DOD-Green-Book/FY2021")
#'
#'   2) Download Comptroller data to Raw folder (manually).
#'
#'   3) Update name of Chapter 6 raw data folder, files
chapter.6.raw.data.folder <- "./Data/Raw/FY21 PB Green Book Chap 6/"
#'
#'   4) Update Name of specific files
tbl.6.22.Army <- "FY21 PB Green Book Table 6-22.xlsx"
tbl.6.23.Navy <- "FY21 PB Green Book Table 6-23.xlsx"
tbl.6.24.USAF <- "FY21 PB Green Book Table 6-24.xlsx"
#'   5) Set current year
current.FY <- 2021
# Libraries ---------------------------------------------------------------
library(tidyverse)
library(readxl)
library(stringr)
# Common Vars and Functions -----------------------------------------------
# Methodology -------------------------------------------------------------
#' Cut up the datasets, combine, then clean all
nettle_clean <- function(file.name,
my.table.number,
dod.service){
outlays.1 <- read_excel(file.name, na = "0", col_names=F, n_max=35)
#Manually enter deflator col
meta.cols <- tibble( current.constant.col = c(rep("delete",  6), #first 6 rows
rep("current",  8),  #7:14
rep("delete",   2),  #15:16
rep("constant", 8),  #17:25
rep("delete",  10)   #24:34
),
Service = dod.service,
source.table = my.table.number)
outlays.2 <- bind_cols(meta.cols, outlays.1)
names(outlays.2) <- c(names(outlays.2[,1:4]),
"Public.Law.Title",
1946:(1946+(ncol(outlays.2)-6)) )
outlays.2<-final.outlays
return(final.outlays)
}
file.name <- paste0(chapter.6.raw.data.folder, tbl.6.22.Army)
my.table.number <- "6.22"
dod.service <- "army"
army.df <- nettle_clean(file.name=file.name,
my.table.number=my.table.number,
dod.service=dod.service)
View(army.df)
outlays.1 <- read_excel(file.name, na = "0", col_names=F, n_max=35)
#Manually enter deflator col
meta.cols <- tibble( current.constant.col = c(rep("delete",  6), #first 6 rows
rep("current",  8),  #7:14
rep("delete",   2),  #15:16
rep("constant", 8),  #17:25
rep("delete",  10)   #24:34
),
Service = dod.service,
source.table = my.table.number)
outlays.2 <- bind_cols(meta.cols, outlays.1)
outlays.2
names(outlays.2)
outlays.2
names(outlays.2) <- c(names(outlays.2[,1:4]),
"Public.Law.Title",
1946:(1946+(ncol(outlays.2)-6)) )
outlays.2
final.outlays <- outlays.2
nettle_clean <- function(file.name,
my.table.number,
dod.service){
outlays.1 <- read_excel(file.name, na = "0", col_names=F, n_max=35)
#Manually enter deflator col
meta.cols <- tibble( current.constant.col = c(rep("delete",  6), #first 6 rows
rep("current",  8),  #7:14
rep("delete",   2),  #15:16
rep("constant", 8),  #17:25
rep("delete",  10)   #24:34
),
Service = dod.service,
source.table = my.table.number)
outlays.2 <- bind_cols(meta.cols, outlays.1)
names(outlays.2) <- c(names(outlays.2[,1:4]),
"Public.Law.Title",
1946:(1946+(ncol(outlays.2)-6)) )
final.outlays <- outlays.2
return(final.outlays)
}
file.name <- paste0(chapter.6.raw.data.folder, tbl.6.22.Army)
my.table.number <- "6.22"
dod.service <- "army"
army.df <- nettle_clean(file.name=file.name,
my.table.number=my.table.number,
dod.service=dod.service)
View(army.df)
c(names(outlays.2[,1:4]),
"Public.Law.Title",
1946:(1946+(ncol(outlays.2)-6)) )
# Info --------------------------------------------------------------------
#' Table 6.22-6.24 DOD OUTLAYS By by Service and Title
#' # How to Update this File -------------------------------------------------
#'
#'   1) Set working Directory to current year:
setwd("./DOD-Green-Book/FY2021")
#'
#'   2) Download Comptroller data to Raw folder (manually).
#'
#'   3) Update name of Chapter 6 raw data folder, files
chapter.6.raw.data.folder <- "./Data/Raw/FY21 PB Green Book Chap 6/"
#'
#'   4) Update Name of specific files
tbl.6.22.Army <- "FY21 PB Green Book Table 6-22.xlsx"
tbl.6.23.Navy <- "FY21 PB Green Book Table 6-23.xlsx"
tbl.6.24.USAF <- "FY21 PB Green Book Table 6-24.xlsx"
#'   5) Set current year
current.FY <- 2021
# Libraries ---------------------------------------------------------------
library(tidyverse)
library(readxl)
library(stringr)
# Common Vars and Functions -----------------------------------------------
# Methodology -------------------------------------------------------------
#' Cut up the datasets, combine, then clean all
nettle_clean <- function(file.name,
my.table.number,
dod.service){
outlays.1 <- read_excel(file.name, na = "0", col_names=F, n_max=35)
#Manually enter deflator col
meta.cols <- tibble( current.constant.col = c(rep("delete",  6), #first 6 rows
rep("current",  8),  #7:14
rep("delete",   2),  #15:16
rep("constant", 8),  #17:25
rep("delete",  10)   #24:34
),
Service = dod.service,
source.table = my.table.number)
outlays.2 <- bind_cols(meta.cols, outlays.1)
names(outlays.2) <- c(names(outlays.2[,1:3]),
"Public.Law.Title", "delete",
1946:(1946+(ncol(outlays.2)-6)) )
final.outlays <- outlays.2
return(final.outlays)
}
# Test Function -----------------------------------------------------------
file.name <- paste0(chapter.6.raw.data.folder, tbl.6.22.Army)
my.table.number <- "6.22"
dod.service <- "army"
army.df <- nettle_clean(file.name=file.name,
my.table.number=my.table.number,
dod.service=dod.service)
View(army.df)
