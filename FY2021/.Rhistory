setwd("~/Documents/R Programming/Repositories/KappBasicPay/Scripts")
setwd("~/Documents/R Programming/Repositories/DOD-Green-Book/FY2021")
# How to Update this File -------------------------------------------------
# 1. Set working directory
setwd("~/Documents/R Programming/Repositories/DOD-Green-Book/FY2021")
y <- "FY19 PB Green Book Chap 7.xlsx"
library(tidyverse)
library(readxl)
# Libraries ---------------------------------------------------------------
library(tidyverse)
library(readxl)
# How to Update this File -------------------------------------------------
# 1. Set working directory
setwd("~/Documents/R Programming/Repositories/DOD-Green-Book/FY2021")
# 2. Change filename
my.filename <- "FY21 PB Green Book Chap 7.xlsx"
my.tab      <- "7-5"
# Common Vars and Functions -----------------------------------------------
#' # Import  Data ------------------------------------------------------------
end.strength <- read_excel(my.filename, my.tab)
dir()
getdir()
get.dir()
getwd()
# Common Vars and Functions -----------------------------------------------
my.filename.full <- str_c(getwd(), "/", my.filename)
my.filename.full
end.strength <- read_excel(my.filename.full, my.tab)
my.filename.full <- str_c(getwd(), "/Data/Raw/", my.filename)
my.filename.full
my.filename.full <- str_c(getwd(), "/Data/Raw/", my.filename)
end.strength <- read_excel(my.filename.full, my.tab)
# 2. Change filename
my.filename <- "FY2021 PB Green Book Chap 7.xlsx"
my.tab      <- "7-5"
# Common Vars and Functions -----------------------------------------------
my.filename.full <- str_c(getwd(), "/Data/Raw/", my.filename)
#' # Import  Data ------------------------------------------------------------
my.filename.full <- str_c(getwd(), "/Data/Raw/", my.filename)
end.strength <- read_excel(my.filename.full, my.tab)
setwd("~/Documents/R Programming/Repositories/DOD-Green-Book/FY2021")
my.filename
# 2. Change filename
my.filename <- "FY21 PB Green Book Chap 7.xlsx"
my.filename
my.filename.full
# How to Update this File -------------------------------------------------
# 1. Set working directory
setwd("~/Documents/R Programming/Repositories/DOD-Green-Book/FY2021")
# 2. Change filename
my.filename <- "FY21 PB Green Book Chap 7.xlsx"
my.tab      <- "7-5"
# Common Vars and Functions -----------------------------------------------
my.filename.full <- str_c(getwd(), "/Data/Raw/", my.filename)
#' # Import  Data ------------------------------------------------------------
my.filename.full <- str_c(getwd(), "/Data/Raw/", my.filename)
end.strength <- read_excel(my.filename.full, my.tab)
dir('/Users/christophermann/Documents/R Programming/Repositories/DOD-Green-Book/FY2021/Data/Raw/')
my.filename.full <- str_c(getwd(), "/Data/Raw/FY_2021_Green_Book/", my.filename)
my.filename.full
end.strength <- read_excel(my.filename.full, my.tab)
View(end.strength)
# Shape Dataset: This Varies from year to to year!
end.strength <- end.strength[c(5:86,  # Area - by row
89),   # Area - by row (ignore base/oco, take total)
c(1,3:7, # Area - by col (remove blank rows, totals)
10:14)  # Area - by col
]
#' # Import  Data ------------------------------------------------------------
my.filename.full <- str_c(getwd(), "/Data/Raw/FY_2021_Green_Book/", my.filename)
end.strength <- read_excel(my.filename.full, my.tab)
# Shape Dataset: This Varies from year to to year!
end.strength <- end.strength[c(5:86,  # Area - by row
89),   # Area - by row (ignore base/oco, take total)
c(1,3:8, # Area - by col (remove blank rows, totals)
10:14)  # Area - by col
]
names(end.strength.data) <- c(
"FY",
"Army,Active",
"Navy,Active",
"Marine Corps,Active",
"Air Force,Active",
"Space Force,Active",
"Full Time Guard and Reserve,Active",
"Army,Civilians",
"Navy and Marine Corps,Civilians",
"Air Force,Civilians",
"Space Force,Civilians",
"Defense Agencies,Civilians"
)
names(end.strength) <- c(
"FY",
"Army,Active",
"Navy,Active",
"Marine Corps,Active",
"Air Force,Active",
"Space Force,Active",
"Full Time Guard and Reserve,Active",
"Army,Civilians",
"Navy and Marine Corps,Civilians",
"Air Force,Civilians",
"Space Force,Civilians",
"Defense Agencies,Civilians"
)
end.strength.data <- end.strength.data[-1,]
end.strength <- end.strength.data[-1,]
end.strength <- end.strength.data[-1,]
end.strength <- end.strength.data[-1,]
end.strength <- end.strength[-1,]
dplyr
dplyr?
?dplyr()
vignette(pivot)
vignette("pivot")
end.strength <- end.strength %>%
pivot_longer(-FY,
names_to = "service",
values_to = "personnel")
# Tidy
end.strength <- end.strength %>%
pivot_longer(-FY,
names_to = "service",
values_to = "personnel",
values_fill = 0 )
#'
# Libraries ---------------------------------------------------------------
library(tidyverse)
library(readxl)
# How to Update this File -------------------------------------------------
# 1. Set working directory
setwd("~/Documents/R Programming/Repositories/DOD-Green-Book/FY2021")
# 2. Change filename
my.filename <- "FY21 PB Green Book Chap 7.xlsx"
my.tab      <- "7-5"
# 3. Shape of Data table
# rows vary year by year, check "Reshape Dataset" in code below
# Common Vars and Functions -----------------------------------------------
my.filename.full <- str_c(getwd(), "/Data/Raw/", my.filename)
#' # Import  Data ------------------------------------------------------------
my.filename.full <- str_c(getwd(), "/Data/Raw/FY_2021_Green_Book/", my.filename)
end.strength <- read_excel(my.filename.full, my.tab)
# Tidy --------------------------------------------------------------------
# Reshape Dataset: This Varies from year to to year!
end.strength <- end.strength[c(5:86,  # Area - by row
89),   # Area - by row (ignore base/oco, take total)
c(1,3:8, # Area - by col (remove blank rows, totals)
10:14)  # Area - by col
]
# Renames
names(end.strength) <- c(
"FY",
"Army,Active",
"Navy,Active",
"Marine Corps,Active",
"Air Force,Active",
"Space Force,Active",
"Full Time Guard and Reserve,Active",
"Army,Civilians",
"Navy and Marine Corps,Civilians",
"Air Force,Civilians",
"Space Force,Civilians",
"Defense Agencies,Civilians"
)
end.strength <- end.strength[-1,]
end.strength <- end.strength %>%
pivot_longer(-FY,
names_to = "service",
values_to = "personnel",
values_fill = 0 )
end.strength <- end.strength %>%
pivot_longer(-FY,
names_to = "service",
values_to = "personnel")
end.strength.data.tdy$FY <-  str_replace_all(end.strength.tdy$FY, "[.]","")
end.strength %>%
mutate(FY = str_replace_all(FY, "//.,""))
end.strength %>%
mutate(FY = FY %>% str_replace_all( "//.,"") )
end.strength %>%
mutate(FY = FY %>% str_replace_all(FY, "//.","" ))
end.strength %>%
mutate(FY = FY %>% str_replace_all("//.","" ))
end.strength %>%
mutate(FY = FY %>% str_replace_all("//.","" ),
personnel = replace_na(personnel, 0) %>% as.numeric() )
end.strength %>%
mutate(FY = FY %>% str_replace_all("//.","" ),
personnel = replace_na(personnel, 0) %>% as.numeric()*1e3 )
end.strength %>%
mutate(FY = FY %>% str_extract("[0-9]"),
personnel = replace_na(personnel, 0) %>% as.numeric()*1e3 )
end.strength %>%
mutate(FY = FY %>% str_extract("[0-9].*"),
personnel = replace_na(personnel, 0) %>% as.numeric()*1e3 )
source('~/Documents/R Programming/Repositories/DOD-Green-Book/FY2019/Scripts/tbl_7.5 End Strength.R', echo=TRUE)
end.strength %>%
mutate(FY = FY %>% str_extract("[0-9]{4}*"),
personnel = replace_na(personnel, 0) %>% as.numeric()*1e3 )
end.strength %>%
mutate(FY = FY %>% str_extract("[0-9]{4}"),
personnel = replace_na(personnel, 0) %>% as.numeric()*1e3 )
end.strength %>%
mutate(FY = FY %>% str_extract("[0-9]{4}"), #Remove dots
personnel = replace_na(personnel, 0) %>% as.numeric()*1e3, ) %>%  #convert numbers
separate(col = Service, into = c("Service", "Active.or.Civilians"), ",")
end.strength %>%
mutate(FY = FY %>% str_extract("[0-9]{4}"), #Remove dots
personnel = replace_na(personnel, 0) %>% as.numeric()*1e3, ) %>%  #convert numbers
separate(col = service, into = c("Service", "Active.or.Civilians"), ",")
end.strength <- end.strength %>%
mutate(FY = FY %>% str_extract("[0-9]{4}"), #Remove dots
personnel = replace_na(personnel, 0) %>% as.numeric()*1e3, ) %>%  #convert numbers
separate(col = service, into = c("Service", "Active.or.Civilians"), ",")
mylocation <- "./Data/Processed"
myfilename <- "tbl.7.5_DOD.Manpower"
mydate <- paste('Updated', format(Sys.time(), format = "_%Y-%m-%d_%H%M") , sep = "")
my.file <- sprintf("%s/%s_%s.csv", mylocation, myfilename, mydate)
my.file
write_csv(end.strength.data.tdy, my.file)
write_csv(end.strength.data, my.file)
write_csv(end.strength, my.file)
